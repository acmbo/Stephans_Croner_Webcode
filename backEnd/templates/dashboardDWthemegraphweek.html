
{% extends 'baseDashboard.html' %}

{% block dependencies %} 
<link rel= "stylesheet" type="text/css" href="{{ url_for('static', filename='stylesheets/style.css') }}" />
<style>

    .links line {
      stroke: #999;
      stroke-opacity: 0.6;
    }
    
    .nodes circle {
      stroke: #fff;
      stroke-width: 1.5px;
    }
    
    text {
      font-family: sans-serif;
      font-size: 10px;
    }

    #dataviz_spec_kwgraph_svg {
        width: 500px;
        height: 500px;
        position: relative; 
        margin: auto; 
        height: 500px !important;
        width: 960px !important; 
        border:1px solid rgb(230, 224, 224);
        border-radius:10px;
        
    }
    
</style>
{% endblock %}

{% block title %} Homepage{% endblock title %}


{% block sitecontent %}
<!--Cotainter for Main Body-->

<!-- Main Body with Informations-->
<div class="col-md-9 ms-sm-auto col-lg-10 px-md-4">
    <div class="chartjs-size-monitor">
        <div class="chartjs-size-monitor-expand">
            <div class=""></div>
        </div>
        <div class="chartjs-size-monitor-shrink">
            <div class=""></div>
        </div>
    </div>
    
    <!--Title Section-->
    <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">

        <h1 class="h2">Scrapper</h1>
        <div class="btn-toolbar mb-2 mb-md-0">

        <button type="button" class="btn btn-sm btn-outline-secondary dropdown-toggle">
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-calendar" aria-hidden="true"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect><line x1="16" y1="2" x2="16" y2="6"></line><line x1="8" y1="2" x2="8" y2="6"></line><line x1="3" y1="10" x2="21" y2="10"></line></svg>
            This week
        </button>
        </div>
    </div>
    
    <!-- Documentation and Information-->

    <div class="accordion" id="accordionExample">
        <div class="accordion-item">
        <h4 class="accordion-header" id="headingOne">
            <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseOne" aria-expanded="false" aria-controls="collapseOne">
            Explanation
            </button>
        </h4>
        <div id="collapseOne" class="accordion-collapse collapse" aria-labelledby="headingOne" data-bs-parent="#accordionExample" style="">
            <div class="accordion-body">
                This site gives the user info about submissions by the scrapper, which fuel the database for analysis of <a href="https://www.dw.com/de/themen/s-9077">DW.com</a>. The scrappers are scanning the site <strong>articles</strong> and download them, if they match a ceratin pattern. This pattern is used by all handwritten articles but <strong> excludes video, media only articles and the main homepage</strong> . The articles then are extracted and gathered in a <a href="https://redis.io/">database</a> and analyzed for their <a href="https://en.wikipedia.org/wiki/Natural_language_processing"> natural language properties</a> .
            </div>
        </div>
        </div>
    </div>

    <!-- Databox and Keywordgraph -->
    <div class="row">
        
        <div style="margin: 1rem;"> 
            <div id="dataviz_spec_kwgraph" class="" >
                <svg id="dataviz_spec_kwgraph_svg" width="800" height="500"></svg>
            </div>
        </div>
    </div>


</div>

{% endblock sitecontent %} 


{% block dependenciesEnd %}
<!--Internal-->
<script src="https://d3js.org/d3.v4.min.js"></script>
<script>

    var svg = d3.select("#dataviz_spec_kwgraph_svg"),
        width = +svg.attr("width"),
        height = +svg.attr("height");

    var color = d3.scaleOrdinal(d3.schemeCategory20);

    var simulation = d3.forceSimulation()
        .force("link", d3.forceLink().id(function(d) { return d.id; }))
        .force("charge", d3.forceManyBody())
        .force("center", d3.forceCenter(width / 2, height / 2));

    //add encompassing group for the zoom 
    var g = svg.append("g")
        .attr("class", "everything");



    d3.json("https://stephanscorner.de/themegraph/themeGraphWeekly/", function(error, graph) {
        if (error) throw error;

        var link = g.append("g")
            .attr("class", "links")
            .selectAll("line")
            .data(graph.links)
            .enter().append("line")
            .attr("stroke-width", function(d) { return Math.sqrt(d.value); });

        var node = g.append("g")
            .attr("class", "nodes")
            .selectAll("g")
            .data(graph.nodes)
            .enter().append("g")

        var circles = node.append("circle")
            .attr("r", 5)
            .attr("fill", function(d) { return color(d.group); });

        // Create a drag handler and append it to the node object instead
        var drag_handler = d3.drag()
        .on("start", dragstarted)
        .on("drag", dragged)
        .on("end", dragended);

        drag_handler(node);

        //add zoom capabilities 
        var zoom_handler = d3.zoom()
            .on("zoom", zoom_actions);

        zoom_handler(svg);

        var lables = node.append("text")
            .text(function(d) {
            return d.id;
            })
            .attr('x', 6)
            .attr('y', 3);

        node.append("title")
            .text(function(d) { return d.id; });

        simulation
            .nodes(graph.nodes)
            .on("tick", ticked);

        simulation.force("link")
            .links(graph.links);

        function ticked() {
        link
            .attr("x1", function(d) { return d.source.x; })
            .attr("y1", function(d) { return d.source.y; })
            .attr("x2", function(d) { return d.target.x; })
            .attr("y2", function(d) { return d.target.y; });

        node
            .attr("transform", function(d) {
            return "translate(" + d.x + "," + d.y + ")";
            })
        }
    });

    function dragstarted(d) {
    if (!d3.event.active) simulation.alphaTarget(0.3).restart();
            d.fx = d.x;
            d.fy = d.y;
        }

    function dragged(d) {
            d.fx = d3.event.x;
            d.fy = d3.event.y;
        }

    function dragended(d) {
        if (!d3.event.active) simulation.alphaTarget(0);
            d.fx = null;
            d.fy = null;
        }

    //Zoom functions 
    function zoom_actions(){
            g.attr("transform", d3.event.transform)
        }

</script>
{% endblock dependenciesEnd %}